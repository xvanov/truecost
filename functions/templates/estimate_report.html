<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ project.name }} - Construction Estimate</title>
    <style>
        {% include 'styles.css' %}
    </style>
</head>
<body>
    {# Cover Page #}
    <div class="cover-page">
        <div class="cover-header">
            <div class="logo-container">
                {% if logo_base64 %}
                <img class="logo-img" src="data:image/png;base64,{{ logo_base64 }}" alt="TrueCost">
                {% endif %}
                <div class="logo-text">TrueCost</div>
            </div>
        {% if client_ready %}
        <div class="subtitle">Construction Cost Estimate</div>
        {% else %}
        <div class="subtitle">Professional Construction Estimation</div>
        {% endif %}
        </div>

        <div class="cover-divider"></div>

        <div class="project-info">
        <div class="project-title">{{ project.name }}</div>
        <div class="project-address">{{ project.address }}</div>
            {% if project.type %}
            <div class="project-type">{{ project.type }} Project</div>
            {% endif %}
        </div>

        <div class="estimate-summary">
            {% if client_ready %}
            {# Client-ready: Show single authoritative total (P80 as recommended budget) #}
            <div class="summary-label">Total Project Estimate</div>
            <div class="total-cost">${{ "{:,.0f}".format(estimate.p80) }}</div>
            {% else %}
            {# Contractor view: Show P50/P80/P90 breakdown #}
            <div class="summary-label">Estimated Project Cost</div>
            <div class="total-cost">${{ "{:,.0f}".format(estimate.total_cost) }}</div>
            <div class="confidence-range">
                <span class="confidence-item"><strong>P50:</strong> ${{ "{:,.0f}".format(estimate.p50) }}</span>
                <span class="confidence-divider">|</span>
                <span class="confidence-item"><strong>P80:</strong> ${{ "{:,.0f}".format(estimate.p80) }}</span>
                <span class="confidence-divider">|</span>
                <span class="confidence-item"><strong>P90:</strong> ${{ "{:,.0f}".format(estimate.p90) }}</span>
            </div>
            {% endif %}
        </div>

        <div class="cover-footer">
            <div class="date-info">
                <span class="date-label">Prepared:</span> {{ report_date }}
            </div>
            {% if not client_ready %}
            <div class="estimate-id">
                <span class="date-label">Estimate ID:</span> {{ estimate_id }}
            </div>
            {% endif %}
        </div>
    </div>

    {# Executive Summary Section #}
    {% if 'executive_summary' in sections %}
    {% include '_executive_summary.html' %}
    {% endif %}

    {# Cost Breakdown Section #}
    {% if 'cost_breakdown' in sections %}
    {% include '_cost_breakdown.html' %}
    {% endif %}

    {# Bill of Quantities Section #}
    {% if 'boq' in sections %}
    {% include '_bill_of_quantities.html' %}
    {% endif %}

    {# Labor Analysis Section #}
    {% if 'labor_analysis' in sections %}
    {% include '_labor_analysis.html' %}
    {% endif %}

    {# Schedule Section #}
    {% if 'schedule' in sections %}
    {% include '_schedule.html' %}
    {% endif %}

    {# Risk Analysis Section - excluded for client-ready mode, replaced with simplified contingency #}
    {% if 'risk_analysis' in sections %}
        {% if client_ready %}
        {% include '_risk_analysis_client.html' %}
        {% else %}
        {% include '_risk_analysis.html' %}
        {% endif %}
    {% endif %}

    {# Assumptions Section #}
    {% if 'assumptions' in sections %}
    {% include '_assumptions.html' %}
    {% endif %}

    {# CAD Plan Section #}
    {% if 'cad_plan' in sections and cad_data %}
    {% include '_cad_plan.html' %}
    {% endif %}

    {# Footer #}
    <div class="section text-center text-muted text-small mt-2">
        {% if client_ready %}
        <div class="disclaimer-box">
            <h4>Important Disclaimers</h4>
            <p>
                This estimate is provided for budgeting and planning purposes only and does not constitute a contract or binding agreement.
                Actual costs may vary based on final material selections, site conditions discovered during construction,
                permit requirements, and market conditions at the time of construction.
            </p>
            <p>
                This estimate is valid for 30 days from the preparation date. Material prices and labor rates are subject to change.
                A formal contract with detailed specifications will be required before work begins.
            </p>
            <p style="margin-top: 12px;">
                <strong>Prepared by TrueCost</strong> | Professional Construction Estimation
            </p>
        </div>
        {% else %}
        <p>
            This estimate was generated by TrueCost AI-powered estimation system.<br>
            All costs are estimates based on current market data and are subject to change.<br>
            For questions, contact your TrueCost representative.
        </p>
        {% endif %}
    </div>
</body>
</html>
